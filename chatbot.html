<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ß–∞—Ç-–±–æ—Ç –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–π</title>
  <style>
  body {
    background: linear-gradient(135deg, #fde0e0, #c7eaff);
    min-height: 100vh;
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
  }

  .chat-container {
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    max-width: 420px;
    width: 100%;
    padding: 24px 20px 16px;
    display: flex;
    flex-direction: column;
    height: 90vh;
    max-height: 90vh;
    position: relative;
  }

  .chat-title {
    text-align: center;
    font-size: 1.6rem;
    font-weight: 700;
    margin-bottom: 16px;
    color: #2d3748;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .chat-box {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    margin-bottom: 16px;
    background: #f8fafc;
    border-radius: 16px;
    border: 1px solid #e2e8f0;
    min-height: 0;
  }

  .input-container {
    position: sticky;
    bottom: 0;
    background: white;
    padding-top: 16px;
    margin-top: auto;
    width: 100%;
    border-top: 1px solid #f1f5f9;
  }

  .suggestions-wrapper {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 12px;
  }

  #fixed-suggestions {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    width: 100%;
  }

  .msg {
    margin: 12px 0;
    display: flex;
    align-items: flex-end;
    animation: slideIn 0.3s ease-out;
  }

  .msg.bot { justify-content: flex-start; }
  .msg.user { justify-content: flex-end; }

  .msg-text {
    padding: 12px 16px;
    border-radius: 18px;
    max-width: 85%;
    word-break: break-word;
    font-size: 1rem;
    line-height: 1.5;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .msg.bot .msg-text {
    background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
    color: #334155;
    border-bottom-left-radius: 6px;
  }

  .msg.user .msg-text {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: white;
    border-bottom-right-radius: 6px;
  }

  .chat-form {
    display: flex;
    gap: 12px;
    margin-top: 12px;
    align-items: stretch;
  }

  .chat-input {
    flex: 1;
    border-radius: 16px;
    border: 2px solid #e2e8f0;
    font-size: 1rem;
    padding: 12px 16px;
    transition: border-color 0.2s, box-shadow 0.2s;
    background: #fff;
    font-family: inherit;
  }

  .chat-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .chat-btn {
    background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
    color: #fff;
    border: none;
    border-radius: 16px;
    padding: 12px 20px;
    cursor: pointer;
    font-size: 1.1rem;
    transition: all 0.2s;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    min-width: 60px;
  }

  .chat-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
  }

  .chat-btn:active {
    transform: translateY(0);
  }

  .suggestions-panel {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 16px;
    justify-content: flex-start;
    animation: slideIn 0.4s ease-out;
  }

  .suggestion-btn,
  .suggestion-date-btn {
    background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
    border: 2px solid transparent;
    border-radius: 14px;
    box-shadow: 0 3px 10px rgba(3, 169, 244, 0.15);
    padding: 10px 18px;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
    font-weight: 500;
    color: #0277bd;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .suggestion-btn:hover,
  .suggestion-btn:focus,
  .suggestion-date-btn:hover,
  .suggestion-date-btn:focus {
    background: linear-gradient(135deg, #03a9f4 0%, #0277bd 100%);
    color: #fff;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(3, 169, 244, 0.3);
  }

  .calendar-row {
    margin-top: 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    flex-wrap: wrap;
  }

  .calendar-row input[type="date"] {
    flex: 1;
    min-width: 160px;
    padding: 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 14px;
    font-size: 1rem;
    font-family: inherit;
    background: #fff;
    color: #334155;
    transition: border-color 0.2s, box-shadow 0.2s;
    min-height: 44px;
    box-sizing: border-box;
  }

  .calendar-row input[type="date"]:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .calendar-row input[type="date"]::-webkit-calendar-picker-indicator {
    background: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='%233b82f6'%3e%3cpath fill-rule='evenodd' d='M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z' clip-rule='evenodd'/%3e%3c/svg%3e") no-repeat;
    background-size: 20px 20px;
    cursor: pointer;
    width: 20px;
    height: 20px;
  }

  .suggestion-back-btn {
    background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
    border: 2px solid #f87171;
    color: #dc2626;
    border-radius: 14px;
    font-size: 1rem;
    padding: 10px 18px;
    cursor: pointer;
    margin-top: 12px;
    transition: all 0.2s;
    font-family: inherit;
    font-weight: 500;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .suggestion-back-btn:hover,
  .suggestion-back-btn:focus {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: #fff;
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);
  }

  /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
  @media (max-width: 480px) {
    body {
      background: #f8fafc;
      padding: 0;
      margin: 0;
      align-items: stretch;
    }

    .chat-container {
      height: 100dvh;
      max-height: 100dvh;
      border-radius: 0;
      padding: 20px 16px 12px;
    }

    .chat-title {
      font-size: 1.4rem;
      margin-bottom: 12px;
    }

    .chat-box {
      padding: 16px 12px;
      margin-bottom: 12px;
    }

    .input-container {
      padding-bottom: env(safe-area-inset-bottom);
    }

    .msg-text {
      font-size: 1rem;
      padding: 12px 16px;
      max-width: 90%;
    }

    .chat-input {
      font-size: 16px;
      padding: 14px 16px;
    }

    .chat-btn {
      padding: 14px 18px;
      font-size: 1.1rem;
      min-width: 56px;
    }

    .suggestions-panel {
      flex-direction: column;
      width: 100%;
      gap: 10px;
      margin-top: 12px;
    }

    .suggestion-btn,
    .suggestion-back-btn,
    .suggestion-date-btn {
      font-size: 1rem;
      padding: 16px;
      width: 100%;
      box-sizing: border-box;
      min-height: 52px;
    }

    .calendar-row {
      flex-direction: column;
      gap: 12px;
      margin-top: 12px;
    }

    .calendar-row input[type="date"] {
      width: 100%;
      min-width: unset;
      padding: 16px;
      font-size: 16px;
      min-height: 52px;
    }

    .calendar-row .suggestion-btn {
      width: 100%;
      margin-top: 0;
    }
  }

  /* –û—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã */
  @media (max-width: 360px) {
    .chat-container {
      padding: 16px 12px 8px;
    }

    .chat-title {
      font-size: 1.3rem;
    }

    .chat-box {
      padding: 12px 8px;
    }

    .msg-text {
      padding: 10px 14px;
      font-size: 0.95rem;
    }

    .suggestion-btn,
    .suggestion-back-btn,
    .suggestion-date-btn {
      padding: 14px 12px;
      font-size: 0.95rem;
    }

    .calendar-row input[type="date"] {
      padding: 14px 12px;
      font-size: 16px;
    }
  }

  /* –ë–æ–ª—å—à–∏–µ —ç–∫—Ä–∞–Ω—ã */
  @media (min-width: 768px) {
    .chat-container {
      max-width: 500px;
      padding: 32px 24px 20px;
    }

    .chat-title {
      font-size: 1.8rem;
      margin-bottom: 20px;
    }

    .chat-box {
      padding: 20px;
      margin-bottom: 20px;
    }

    .msg {
      margin: 16px 0;
    }

    .msg-text {
      padding: 14px 18px;
      font-size: 1.1rem;
    }

    .chat-input {
      padding: 14px 18px;
      font-size: 1.1rem;
    }

    .chat-btn {
      padding: 14px 24px;
      font-size: 1.2rem;
    }

    .suggestion-btn,
    .suggestion-date-btn {
      padding: 12px 20px;
      font-size: 1.1rem;
    }

    .suggestion-back-btn {
      padding: 12px 20px;
      font-size: 1.1rem;
    }

    .calendar-row input[type="date"] {
      padding: 14px 18px;
      font-size: 1.1rem;
    }
  }

  /* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
  @media (prefers-color-scheme: dark) {
    body {
      background: linear-gradient(135deg, #1a202c, #2d3748);
    }

    .chat-container {
      background: #2d3748;
      color: #e2e8f0;
    }

    .chat-box {
      background: #1a202c;
      border-color: #4a5568;
    }

    .msg.bot .msg-text {
      background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
      color: #e2e8f0;
    }

    .chat-input {
      background: #1a202c;
      border-color: #4a5568;
      color: #e2e8f0;
    }

    .chat-input:focus {
      border-color: #63b3ed;
    }

    .calendar-row input[type="date"] {
      background: #1a202c;
      border-color: #4a5568;
      color: #e2e8f0;
    }

    .calendar-row input[type="date"]:focus {
      border-color: #63b3ed;
    }

    .input-container {
      background: #2d3748;
      border-top-color: #4a5568;
    }
  }

  /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
  .chat-box::-webkit-scrollbar {
    width: 6px;
  }

  .chat-box::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 3px;
  }

  .chat-box::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
  }

  .chat-box::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  .suggestions-wrapper::-webkit-scrollbar {
    width: 6px;
  }

  .suggestions-wrapper::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 3px;
  }

  .suggestions-wrapper::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
  }
</style>
  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É supabase –ü–ï–†–í–û–ô -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <div class="chat-container">
    <div class="chat-title">–ß–∞—Ç-–±–æ—Ç –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–π</div>
    <div class="chat-box" id="chatBox"></div>
    <div id="fixed-suggestions"></div> <!-- –í–æ—Ç —Ç—É—Ç! -->
    <form class="chat-form" id="chatForm" autocomplete="off">
      <input type="text" class="chat-input" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." autofocus>
      <button type="submit" class="chat-btn">‚û§</button>
    </form>
  </div>
  <!-- –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π JS —Ç–æ–ª—å–∫–æ –Ω–∏–∂–µ, –ø–æ—Å–ª–µ DOM –∏ –ø–æ—Å–ª–µ supabase-js -->
  <script>

 // Supabase init (–∑–∞–º–µ–Ω–∏ –∫–ª—é—á–∏ –Ω–∞ —Å–≤–æ–∏!)
const supa = supabase.createClient(
  'https://bmaypefwycendocuyqvj.supabase.co', 
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJtYXlwZWZ3eWNlbmRvY3V5cXZqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA2MTQyNzYsImV4cCI6MjA2NjE5MDI3Nn0.PJqTJ8079mkZZaAGDrw6rvjhxuZSCBiAQTGa_lRLMBw'
);

const stylists = ["–ê–Ω–Ω–∞", "–ò–≤–∞–Ω", "–ú–∞—Ä–∏—è"];
const services = ["–°—Ç—Ä–∏–∂–∫–∞", "–û–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ", "–£–∫–ª–∞–¥–∫–∞"];

function formatToIso(date) {
  if (date instanceof Date) {
    const yyyy = date.getFullYear();
    const mm = String(date.getMonth() + 1).padStart(2, "0");
    const dd = String(date.getDate()).padStart(2, "0");
    return `${yyyy}-${mm}-${dd}`;
  }
  if (typeof date === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(date)) {
    return date;
  }
  if (typeof date === 'string' && /^\d{2}[.\-]\d{2}[.\-]\d{4}$/.test(date)) {
    const [d, m, y] = date.split(/[.\-]/);
    return `${y}-${m}-${d}`;
  }
  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth()+1).padStart(2,"0");
  const dd = String(now.getDate()).padStart(2,"0");
  return `${yyyy}-${mm}-${dd}`;
}

// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —Å–ª–æ—Ç–æ–≤ –≤ –≤–∏–¥–µ "HH:MM"
function getTimeSlots(start = "10:00", end = "18:00") {
  const slots = [];
  let [h, m] = start.split(":").map(Number);
  let [eh, em] = end.split(":").map(Number);
  while (h < eh || (h === eh && m < em)) {
    slots.push((h < 10 ? "0" : "") + h + ":" + (m === 0 ? "00" : m));
    m += 30;
    if (m === 60) { h++; m = 0; }
  }
  if (slots.length > 0) slots.pop();
  return slots;
}

// –§–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ë–î ("10:00" -> "10:00:00")
function formatTimeForDb(str) {
  if (/^\d{1,2}:\d{2}$/.test(str)) return str + ":00";
  if (/^\d{1,2}:\d{2}:\d{2}$/.test(str)) return str;
  return "00:00:00";
}

let step = 0;
let data = {};
let calendarOpen = false;
let busy = false;

const chatBox = document.getElementById('chatBox');
const chatForm = document.getElementById('chatForm');
const chatInput = document.getElementById('chatInput');
const suggestionsPanel = document.getElementById('fixed-suggestions');

// ========== UI –∏ —É—Ç–∏–ª–∏—Ç—ã ==========

function clearSuggestions() {
  suggestionsPanel.innerHTML = "";
  calendarOpen = false;
}

function showSuggestions(buttons = [], { back = true, calendar = false, calendarCallback = null } = {}) {
  clearSuggestions();
  const panel = document.createElement('div');
  panel.className = 'suggestions-panel';

  if (Array.isArray(buttons) && buttons.length > 0) {
    buttons.forEach(val => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'suggestion-btn';
      btn.textContent = val;
      btn.onclick = async () => {
        if (busy) return;
        busy = true;
        await processInput(val);
        busy = false;
      };
      panel.appendChild(btn);
    });
  }

  if (calendar) {
    const row = document.createElement('div');
    row.className = 'calendar-row';
    const inp = document.createElement('input');
    inp.type = 'date';
    inp.min = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split("T")[0];
    inp.className = 'suggestion-date-btn';
    row.appendChild(inp);
    const submit = document.createElement('button');
    submit.type = 'button';
    submit.className = 'suggestion-btn';
    submit.textContent = '–í—ã–±—Ä–∞—Ç—å';
    submit.onclick = async () => {
      if (busy) return;
      busy = true;
      if (inp.value && calendarCallback) await calendarCallback(inp.value);
      busy = false;
    };
    row.appendChild(submit);
    panel.appendChild(row);
    calendarOpen = true;
  }

  suggestionsPanel.appendChild(panel);

  if (back) {
    const backBtn = document.createElement('button');
    backBtn.type = 'button';
    backBtn.className = 'suggestion-back-btn';
    backBtn.textContent = '–ù–∞–∑–∞–¥';
    backBtn.onclick = async () => {
      if (busy) return;
      busy = true;
      await processInput("–Ω–∞–∑–∞–¥");
      busy = false;
    };
    suggestionsPanel.appendChild(backBtn);
  }
}

function appendMessage(from, text) {
  const msgDiv = document.createElement('div');
  msgDiv.className = `msg ${from}`;
  const msgText = document.createElement('div');
  msgText.className = 'msg-text';
  msgText.innerHTML = text.replace(/\n/g, '<br>');
  msgDiv.appendChild(msgText);
  chatBox.appendChild(msgDiv);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function bot(text) { appendMessage('bot', text); }
function user(text) { appendMessage('user', text); }
function normalize(str) { return str.toLowerCase().replace(/[—ë]/g, '–µ').trim(); }

function getService(input) {
  input = normalize(input);
  const num = parseInt(input) - 1;
  if (!isNaN(num) && services[num]) return services[num];
  return services.find(s => normalize(s) === input);
}
function getStylist(input) {
  input = normalize(input);
  const num = parseInt(input) - 1;
  if (!isNaN(num) && stylists[num]) return stylists[num];
  return stylists.find(s => normalize(s) === input);
}
function isValidDate(input) {
  return /^(\d{2})[.\-](\d{2})([.\-]\d{4})?$/.test(input);
}

function dateToRuString(date) {
  if (!(date instanceof Date)) date = new Date(date);
  return `${String(date.getDate()).padStart(2, '0')}.${String(date.getMonth() + 1).padStart(2, '0')}.${date.getFullYear()}`;
}
function toRuDate(input) {
  if (!/^\d{4}-\d{2}-\d{2}$/.test(input)) return input;
  const [y, m, d] = input.split('-');
  return `${d}.${m}.${y}`;
}

function isFutureDate(input) {
  let dt;
  if (/^\d{4}-\d{2}-\d{2}$/.test(input)) {
    dt = new Date(input);
  } else if (/^\d{2}[.\-]\d{2}[.\-]\d{4}$/.test(input)) {
    const parts = input.split(/[.\-]/);
    dt = new Date(`${parts[2]}-${parts[1]}-${parts[0]}`);
  } else {
    return false;
  }
  const now = new Date();
  dt.setHours(0, 0, 0, 0);
  now.setHours(0, 0, 0, 0);
  return dt >= now;
}

async function getFreeSlots(date, stylist) {
  const allSlots = getTimeSlots();
  let free = [...allSlots];
  try {
    const { data: bookings, error } = await supa
      .from('bookings')
      .select('time')
      .eq('date', date)
      .eq('stylist', stylist);
    if (!error && bookings) {
      // busy: ["10:00:00", ...]
      const busy = bookings.map(b => (b.time.length === 8 ? b.time.substring(0, 5) : b.time));
      free = allSlots.filter(slot => !busy.includes(slot));
    }
  } catch (err) {
    console.error('getFreeSlots exception', err);
  }
  return free;
}

async function addBooking({ service, stylist, date, time, name }) {
  try {
    const res = await supa
      .from('bookings')
      .insert([{ service, stylist, date, time, name }]);
    if (res.error) {
      console.error('addBooking error', res.error);
      return false;
    }
    return true;
  } catch (err) {
    console.error('addBooking exception', err);
    return false;
  }
}

function reset() {
  step = 0;
  data = {};
  clearSuggestions();
  setTimeout(() => {
    bot("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–π.<br>–•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É—Å–ª—É–≥—É?<br>–î–ª—è –æ—Ç–º–µ–Ω—ã –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—à–∏—Ç–µ <b>–æ—Ç–º–µ–Ω–∞</b>, –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É <b>–ù–∞–∑–∞–¥</b>.");
    showSuggestions(["–î–∞"], { back: false });
  }, 500);
}

function checkCommon(input) {
  if (["—Å–ø–∞—Å–∏–±–æ", "–±–ª–∞–≥–æ–¥–∞—Ä—é"].includes(normalize(input))) {
    bot("–†–∞–¥—ã –ø–æ–º–æ—á—å! –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å üòä");
    return true;
  }
  if (["–ø–æ–∫–∞", "–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è", "bye", "goodbye"].includes(normalize(input))) {
    bot("–î–æ –≤—Å—Ç—Ä–µ—á–∏! –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è!");
    return true;
  }
  if (normalize(input) === "–æ—Ç–º–µ–Ω–∞") {
    reset();
    return true;
  }
  if (normalize(input).includes("–∞–¥—Ä–µ—Å")) {
    bot("–ú—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –ø–æ –∞–¥—Ä–µ—Å—É: —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥.1.");
    return true;
  }
  if (normalize(input).includes("—Ü–µ–Ω–∞") || normalize(input).includes("—Å—Ç–æ–∏–º–æ—Å—Ç—å")) {
    bot("–°—Ç–æ–∏–º–æ—Å—Ç—å —É—Ç–æ—á–Ω—è–π—Ç–µ —É –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–ª–∏ –Ω–∞ —Å–∞–π—Ç–µ. –ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã:<br>- –°—Ç—Ä–∏–∂–∫–∞: 1200‚ÇΩ<br>- –û–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ: 3500‚ÇΩ<br>- –£–∫–ª–∞–¥–∫–∞: 1000‚ÇΩ");
    return true;
  }
  if (normalize(input).includes("—Ä–µ–∂–∏–º") || normalize(input).includes("—á–∞—Å—ã")) {
    bot("–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 10:00 –¥–æ 18:00.");
    return true;
  }
  return false;
}

// ======== –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –ü–û–í–¢–û–†–ê –®–ê–ì–ê ========
function repeatCurrentStep() {
  switch (step) {
    case 0:
      bot("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –±–æ—Ç-–ø–æ–º–æ—â–Ω–∏–∫ –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä—Å–∫–æ–π.<br>–•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —É—Å–ª—É–≥—É?<br>–î–ª—è –æ—Ç–º–µ–Ω—ã –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –Ω–∞–ø–∏—à–∏—Ç–µ <b>–æ—Ç–º–µ–Ω–∞</b>, –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É <b>–ù–∞–∑–∞–¥</b>.");
      showSuggestions(["–î–∞"], {back: false});
      break;
    case 1:
      bot("–û—Ç–ª–∏—á–Ω–æ! –ö–∞–∫—É—é —É—Å–ª—É–≥—É –≤—ã –±—ã —Ö–æ—Ç–µ–ª–∏ –≤—ã–±—Ä–∞—Ç—å?");
      showSuggestions(services);
      break;
    case 2:
      bot("–ö—Ç–æ –∏–∑ —Å—Ç–∏–ª–∏—Å—Ç–æ–≤ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?");
      showSuggestions(stylists);
      break;
    case 3:
      bot("–ù–∞ –∫–∞–∫—É—é –¥–∞—Ç—É –∑–∞–ø–∏—Å–∞—Ç—å?");
      let today = new Date();
      let tomorrow = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
      let afterTomorrow = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 2);
      showSuggestions([
        dateToRuString(tomorrow),
        dateToRuString(afterTomorrow),
        "–î—Ä—É–≥–∞—è –¥–∞—Ç–∞"
      ]);
      break;
    case 4:
      bot(`–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ <b>${data.userInputDate}</b>:`);
      showSuggestions(data.slots || []);
      bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –ø–æ –∫–Ω–æ–ø–∫–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞.");
      break;
    case 41:
      bot(
        `–í—ã –≤—ã–±—Ä–∞–ª–∏:<br>
         –£—Å–ª—É–≥–∞: <b>${data.service}</b><br>
         –°—Ç–∏–ª–∏—Å—Ç: <b>${data.stylist}</b><br>
         –î–∞—Ç–∞: <b>${data.userInputDate}</b><br>
         –í—Ä–µ–º—è: <b>${data.time}</b><br>
         –í—Å—ë –≤–µ—Ä–Ω–æ? (–¥–∞ / –Ω–∞–∑–∞–¥)`
      );
      showSuggestions(["–î–∞"]);
      break;
    case 5:
      bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –∏–º—è.");
      showSuggestions([], {back:true});
      break;
    case 6:
      bot(`–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å, –Ω–∞–ø–∏—à–∏—Ç–µ <b>–∑–∞–ø–∏—Å–∞—Ç—å—Å—è</b>.`);
      showSuggestions(["–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"], {back:false});
      break;
    default:
      bot("–î–ª—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞–ø–∏—à–∏—Ç–µ <b>–∑–∞–ø–∏—Å–∞—Ç—å—Å—è</b>.");
      showSuggestions(["–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"], {back:false});
      break;
  }
}

// ========== –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ ==========

async function processInput(input) {
  input = input.trim();
  if (!input) return;
  user(input);
  clearSuggestions();

  if (normalize(input) === "–Ω–∞–∑–∞–¥") {
    if (step > 0) step--;
    if (step <= 3) {
      data.userInputDate = null;
      data.date = null;
      data.slots = null;
      data.time = null;
    }
    if (step <= 2) {
      data.stylist = null;
    }
    repeatCurrentStep();
    return;
  }

  // üîß –î–û–ë–ê–í–¨ –≠–¢–û –ó–î–ï–°–¨
  if (normalize(input) === "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è") {
    reset();
    return;
  }

  if (checkCommon(input)) return;


  switch (step) {
    case 0: {
      if (normalize(input) === "–¥–∞" || normalize(input) === "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è") {
        bot("–û—Ç–ª–∏—á–Ω–æ! –ö–∞–∫—É—é —É—Å–ª—É–≥—É –≤—ã –±—ã —Ö–æ—Ç–µ–ª–∏ –≤—ã–±—Ä–∞—Ç—å?");
        showSuggestions(services);
        step = 1;
      } else {
        bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ <b>–¥–∞</b> –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É.");
        showSuggestions(["–î–∞"], { back: false });
      }
      break;
    }
    case 1: {
      let service = getService(input);
      if (!service) {
        bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É –∏–∑ —Å–ø–∏—Å–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é:");
        showSuggestions(services);
      } else {
        data.service = service;
        bot(`–í—ã –≤—ã–±—Ä–∞–ª–∏: <b>${service}</b>.<br>–ö—Ç–æ –∏–∑ —Å—Ç–∏–ª–∏—Å—Ç–æ–≤ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?`);
        showSuggestions(stylists);
        step = 2;
      }
      break;
    }
    case 2: {
      let stylist = getStylist(input);
      if (!stylist) {
        bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª–∏—Å—Ç–∞ –ø–æ –∫–Ω–æ–ø–∫–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –∏–º—è –ø–æ–ª–Ω–æ—Å—Ç—å—é:");
        showSuggestions(stylists);
      } else {
        data.stylist = stylist;
        bot("–û—Ç–ª–∏—á–Ω–æ, <b>" + stylist + "</b>.<br>–ù–∞ –∫–∞–∫—É—é –¥–∞—Ç—É –∑–∞–ø–∏—Å–∞—Ç—å?");
        let today = new Date();
        let tomorrow = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
        let afterTomorrow = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 2);
        const btns = [
          dateToRuString(tomorrow),
          dateToRuString(afterTomorrow),
          "–î—Ä—É–≥–∞—è –¥–∞—Ç–∞"
        ];
        showSuggestions(btns);
        step = 3;
      }
      break;
    }
    case 3: {
      data.time = null;
      data.slots = null;

      let today = new Date();
      let tomorrow = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
      let afterTomorrow = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 2);

      if (/^\d{1,2}:\d{2}$/.test(input.trim())) {
        bot("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É, –ø–æ—Ç–æ–º –ø–æ—è–≤–∏—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≤—Ä–µ–º–µ–Ω–∏!");
        showSuggestions([
          dateToRuString(tomorrow),
          dateToRuString(afterTomorrow),
          "–î—Ä—É–≥–∞—è –¥–∞—Ç–∞"
        ]);
        return;
      }

      if (input === "–î—Ä—É–≥–∞—è –¥–∞—Ç–∞") {
        bot("–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É —á–µ—Ä–µ–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∏–∂–µ.");
        showSuggestions([], {
          calendar: true,
          calendarCallback: async function (val) {
            await processInput(toRuDate(val));
          }
        });
        step = 3.1;
        return;
      }
      let pickedDate = null;
      if (input === dateToRuString(tomorrow)) pickedDate = tomorrow;
      else if (input === dateToRuString(afterTomorrow)) pickedDate = afterTomorrow;
      else if (isValidDate(input)) {
        const parts = input.split(/[.\-]/);
        if (parts.length >= 2) {
          pickedDate = new Date(parts[2] || today.getFullYear(), parts[1] - 1, parts[0]);
        }
      }

      if (!pickedDate || !isFutureDate(formatToIso(pickedDate))) {
        bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É —Å –ø–æ–º–æ—â—å—é –∫–Ω–æ–ø–∫–∏ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–∞—Ç—É (–î–î.–ú–ú –∏–ª–∏ –î–î.–ú–ú.–ì–ì–ì–ì).");
        showSuggestions([
          dateToRuString(tomorrow),
          dateToRuString(afterTomorrow),
          "–î—Ä—É–≥–∞—è –¥–∞—Ç–∞"
        ]);
        return;
      }

      data.userInputDate = toRuDate(formatToIso(pickedDate));
      data.date = formatToIso(pickedDate);
      data.time = null;

      const freeSlots = await getFreeSlots(data.date, data.stylist);
      if (freeSlots.length === 0) {
        bot(`–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ <b>${data.userInputDate}</b> —É —Å—Ç–∏–ª–∏—Å—Ç–∞ <b>${data.stylist}</b> –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤.<br>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É.`);
        showSuggestions([
          dateToRuString(tomorrow),
          dateToRuString(afterTomorrow),
          "–î—Ä—É–≥–∞—è –¥–∞—Ç–∞"
        ]);
      } else {
        data.slots = freeSlots;
        bot(`–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ <b>${data.userInputDate}</b>:`);
        showSuggestions(freeSlots);
        bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –ø–æ –∫–Ω–æ–ø–∫–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞.");
        step = 4;
      }
      break;
    }
    case 3.1: {
      data.time = null;
      data.slots = null;
      let inputDate = input;
      let isoDate = inputDate;
      if (/^\d{2}\.\d{2}\.\d{4}$/.test(inputDate)) {
        const [d, m, y] = inputDate.split(".");
        isoDate = `${y}-${m}-${d}`;
      }
      if (!/^\d{4}-\d{2}-\d{2}$/.test(isoDate)) {
        bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –¥–∞—Ç—É.");
        showSuggestions([], {
          calendar: true,
          calendarCallback: async function (val) {
            await processInput(toRuDate(val));
          }
        });
        return;
      }
      data.userInputDate = toRuDate(isoDate);
      data.date = isoDate;
      data.time = null;
      const freeSlots = await getFreeSlots(data.date, data.stylist);
      if (freeSlots.length === 0) {
        bot(`–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ <b>${data.userInputDate}</b> —É —Å—Ç–∏–ª–∏—Å—Ç–∞ <b>${data.stylist}</b> –Ω–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤.<br>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É.`);
        let today = new Date();
        let tomorrow = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 1);
        let afterTomorrow = new Date(today.getFullYear(), today.getMonth(), today.getDate() + 2);
        showSuggestions([
          dateToRuString(tomorrow),
          dateToRuString(afterTomorrow),
          "–î—Ä—É–≥–∞—è –¥–∞—Ç–∞"
        ]);
        step = 3;
      } else {
        data.slots = freeSlots;
        bot(`–°–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ <b>${data.userInputDate}</b>:`);
        showSuggestions(freeSlots);
        bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –ø–æ –∫–Ω–æ–ø–∫–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞.");
        step = 4;
      }
      break;
    }
    case 4: {
      let val = input.trim();

      // === –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –í–í–ï–õ–ò –ß–ò–°–õ–û (–Ω–æ–º–µ—Ä —Å–ª–æ—Ç–∞) ‚Äî –∏—â–µ–º –ø–æ –∏–Ω–¥–µ–∫—Å—É
      if (/^\d+$/.test(val)) {
        const idx = parseInt(val, 10) - 1;
        if (data.slots && data.slots[idx]) {
          val = data.slots[idx];
        }
      }

      if (!data.slots || !data.slots.includes(val)) {
        bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –ø–æ –∫–Ω–æ–ø–∫–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞.");
        showSuggestions(data.slots || []);
      } else {
        data.time = val; // —Ñ–æ—Ä–º–∞—Ç "HH:MM"
        bot(
          `–í—ã –≤—ã–±—Ä–∞–ª–∏:<br>
           –£—Å–ª—É–≥–∞: <b>${data.service}</b><br>
           –°—Ç–∏–ª–∏—Å—Ç: <b>${data.stylist}</b><br>
           –î–∞—Ç–∞: <b>${data.userInputDate}</b><br>
           –í—Ä–µ–º—è: <b>${data.time}</b><br>
           –í—Å—ë –≤–µ—Ä–Ω–æ? (–¥–∞ / –Ω–∞–∑–∞–¥)`
        );
        showSuggestions(["–î–∞"]);
        step = 41;
      }
      break;
    }
    case 41: {
  if (normalize(input) === "–¥–∞") {
    bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –∏–º—è.");
    showSuggestions([], { back: true });
    step = 5;
  } else if (normalize(input) === "–Ω–∞–∑–∞–¥") {
    step = 4;
    data.time = null;
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã
    data.slots = await getFreeSlots(data.date, data.stylist);
    // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∫–Ω–æ–ø–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã
    clearSuggestions();
    showSuggestions(data.slots || []);
    bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –ø–æ –∫–Ω–æ–ø–∫–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞.");
  } else {
    bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ <b>–¥–∞</b> –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –ù–∞–∑–∞–¥.");
    showSuggestions(["–î–∞"]);
  }
  break;
}


    case 5: {
      if (input.length < 2) {
        bot("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–º—è.");
        showSuggestions([], { back: true });
      } else {
        data.name = input;
        const ok = await addBooking({
          service: data.service,
          stylist: data.stylist,
          date: data.date,
          time: formatTimeForDb(data.time),
          name: data.name
        });
        if (ok) {
          bot(
            `–°–ø–∞—Å–∏–±–æ, <b>${data.name}</b>!<br><br>` +
            `–í–∞—à–∞ –∑–∞—è–≤–∫–∞:<br>` +
            `–£—Å–ª—É–≥–∞: <b>${data.service}</b><br>` +
            `–°—Ç–∏–ª–∏—Å—Ç: <b>${data.stylist}</b><br>` +
            `–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: <b>${data.userInputDate} ${data.time}</b><br><br>` +
            `–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.<br><br>–î–ª—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞–ø–∏—à–∏—Ç–µ <b>–∑–∞–ø–∏—Å–∞—Ç—å—Å—è</b>.`
          );
          showSuggestions(["–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"], { back: false });
        } else {
          bot("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.");
          showSuggestions([], { back: true });
        }
        step = 6;
      }
      break;
    }
    case 6: {
      if (normalize(input) === "–∑–∞–ø–∏—Å–∞—Ç—å—Å—è" || normalize(input) === "–¥–∞") {
        reset();
      } else {
        bot(`–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å, –Ω–∞–ø–∏—à–∏—Ç–µ <b>–∑–∞–ø–∏—Å–∞—Ç—å—Å—è</b>.`);
        showSuggestions(["–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"], { back: false });
      }
      break;
    }
    default: {
      bot("–Ø –≤–∞—Å –Ω–µ –ø–æ–Ω—è–ª. –î–ª—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –Ω–∞–ø–∏—à–∏—Ç–µ <b>–∑–∞–ø–∏—Å–∞—Ç—å—Å—è</b>.");
      showSuggestions(["–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"], { back: false });
      break;
    }
  }
}

// ========== –°—Ç–∞—Ä—Ç ==========
reset();

chatForm.onsubmit = async function (e) {
  e.preventDefault();
  if (busy) return;
  busy = true;
  const val = chatInput.value;
  chatInput.value = "";
  await processInput(val);
  busy = false;
};


  </script>
</body>
</html>
